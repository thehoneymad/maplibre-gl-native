# Using Conan.io instead of Mason
MapLibre GL Native stil uses [Mason](https://github.com/mapbox/mason), Mapbox's depcreated cross platform C/C++ package manager to resolve precompiled binaries for third party dependencies.

This document speaks towards using [conan.io](https://conan.io/) instead of Mason to resolve C/C++ precompiled binaries for third-party dependencies.

## Motivation
MapLibre GL Native was forked off Mapbox GL Native. This means for historical reasons MapLibre GL Native has dependencies maintained by Mapbox. Usage of [Mason](https://github.com/mapbox/mason) is one of them. The motivation behind replacing [Mason](https://github.com/mapbox/mason) are the following:

1. Mason is not actively maintained anymore by Mapbox. Since May 19, 2022, Mason is declared `unmaintained`.
2. Mason strongly prefers static libraries over shared libraries and does not understand dependency trees. A developer is responsible to wiring dependency resolution according to the hierarchy.
3. Mapbox has been aggresively removing their open source footprint. For example, Mapbox geocoder Carmen is not available in Github anymore. This leaves a small risk of Mapbox removing Mason from Github completely. This could lead to build breakage for MapLibre and MapLibre customers.
4. Mason also brings in Mapbox maintained dependencies such as [earcut.hpp](https://github.com/mapbox/earcut.hpp) and [geojson-vt-cpp](https://github.com/mapbox/geojson-vt-cpp). MapLibre currently does not have a fork or mirror for any of these repositories and is susceptive to the same risk mentioned above.

At the time of writing Mason is used to resolve the following dependencies:
1. earcut.hpp
2. geojson-vt-cpp
3. Boost
4. RapidJSON
5. SQLite

## Proposed Change

This document proposes the following changes:

1. MapLibre GL Native SHOULD use [conan.io](https://conan.io/) insted of [Mason](https://github.com/mapbox/mason) to resolve third party binary or header only dependencies.
2. MapLibre GL Native SHOULD use [conan.io](https://conan.io/) insted of [Mason](https://github.com/mapbox/mason) to publish and host [earcut.hpp](https://github.com/mapbox/earcut.hpp) and [geojson-vt-cpp](https://github.com/mapbox/geojson-vt-cpp). MapLibre Native GL SHOULD fork said libraries under MapLibre umbrella.

## Why Conan.io? What alternatives are out there?

In the C++ community, at the time of writing there are two front-runners for depdendency management: Conan and vcpkg. For brevity, this document does not speak of other lesser known dependency management systems.

We are starting with a comparison table for Conan.io and vcpkg.

| Feature     | Conan.io   | vcpkg |
| ----------- | ----------- |-------|
| Made by | Conan.io | Microsoft |
| Platform| Linux, OSX, Windows. | Linux, OSX, Windows, Solaris, FreeBSD, embedded and cross-compiling. |
| Hosting | Decentralized: Artifactory, Bintray, private. Defaults to conancenter. | Centralized hosting only. |
| Binary Packages | Conan uses recipes to generate N package variants per package. Source and recipe settings determine binary version. It is flexible in nature. | vcpkg identify a binary build to be same if the binary build, the associated build system, and content of any environment variable has not change. It is conservative in nature. |
| Configuration Cache | Artifactory. Currently Conan hosts ~100 common configurations. |  vcpkg uses Nuget. Nuget is well loved in dotnet community. But not outside. |
| Build System | Cmake, MSBuild, Meson, and more. | CMake, and MSBuild. |
| Linking Type | Static and Shared. | Static and Shared. Shared linking requies extra work. |
| CMakeLists.txt Usage| Automatically updates CMakeLists.txt. | Manual update to CMakeLists.txt needed for new dependency inclusion. |
| Hosted Package Count| Conan.io hosts ~600 unique libraries. It also hosts about 100K+ known binaries. | vcpkgs hosts about 2K+ pacakges. |
| Versioning| Conan.io versioning works like PIP. It uses independent versioning for all its dependencies. | vcpkgs uses independent versioning or exact versioning. An exact versioning in vcpkg allows vcpkg to guarantee in a single snapshot, a subset of dependencies work well together. |
| Cross Platform Experience | | |
| Publishing and Integration| | |
| Process to request for adding a library|||



Both of the dependency managers maintain a MIT license.

## API Modifications

Outline what modifications you expect on the public API due to your change.

## Migration Plan and Compatibility

If your change is incompatible with existing APIs, draft a migration plan to help users adapting to the new version once your change is completed.

## Rejected Alternatives

Discuss what alternatives to your proposed change you considered and why you rejected them.


## References
1. [vcpkg binary caching](https://github.com/microsoft/vcpkg/blob/master/docs/users/binarycaching.md#implementation-notes-internal-details-subject-to-change-without-notice)
2. [Conan.io package ABI compatbility](https://docs.conan.io/en/latest/creating_packages/define_abi_compatibility.html) 
